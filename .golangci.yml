# golangci-lint configuration file
# Reference: https://golangci-lint.run/usage/configuration/
# This file configures golangci-lint, a fast and customizable Go linters runner.
# Version: Compatible with golangci-lint v2.x and later

version: "2"

# Run configuration
# Controls how golangci-lint executes and what it processes
run:
  # Options: readonly (default), vendor, mod, sum
  # readonly: Do not modify go.mod/go.sum during module download
  modules-download-mode: readonly
  
  # Run linters on test files
  # Set to false to skip linting test files
  tests: false
  
  # Allow multiple golangci-lint processes to run concurrently
  allow-parallel-runners: true

# Linters configuration
# Defines which linters to enable/disable
linters:
  # Enable all linters by default
  # This ensures new linters are automatically included in future versions
  default: all
  
  # Disabled linters with explanations
  disable:
    # Cyclop: Calculates cyclomatic complexity
    # Disabled: Too strict for practical use, can flag reasonable code
    - cyclop
    
    # Depguard: Checks if package imports are in a list of acceptable packages
    # Disabled: No dependency restrictions needed for this project
    - depguard
    
    # Dupl: Detects code duplication
    # Disabled: Can flag intentional similar patterns in different contexts
    - dupl
    
    # Err113: Checks for error wrapping according to Go 1.13+ standards
    # Disabled: Too restrictive for this codebase's error handling style
    - err113
    
    # Exhaustive: Checks exhaustiveness of enum switch statements
    # Disabled: Not all enums require exhaustive switches
    - exhaustive
    
    # Exhaustruct: Checks if all struct fields are initialized
    # Disabled: Not all struct fields need explicit initialization
    - exhaustruct
    
    # Forcetypeassert: Finds forced type assertions
    # Disabled: Acceptable in certain contexts where types are known
    - forcetypeassert
    
    # Funlen: Detects long functions
    # Disabled: Function length is contextual; some complex functions are justified
    - funlen
    
    # Gochecknoglobals: Checks that no global variables exist
    # Disabled: Some global variables are necessary and acceptable
    - gochecknoglobals
    
    # Gochecknoinits: Checks that no init functions exist
    # Disabled: Init functions are sometimes necessary
    - gochecknoinits
    
    # Gocognit: Computes and checks cognitive complexity of functions
    # Disabled: Similar to cyclomatic complexity, too strict for practical use
    - gocognit
    
    # Goconst: Finds repeated strings that could be replaced by a constant
    # Disabled: Not all repeated strings should be constants
    - goconst
    
    # Intrange: Finds places where int range loop can be simplified
    # Disabled: Explicit ranges are sometimes clearer
    - intrange
    
    # Ireturn: Checks that functions return concrete types instead of interfaces
    # Disabled: Returning interfaces is often preferred for flexibility
    - ireturn
    
    # Lll: Reports long lines
    # Disabled: Line length is enforced via revive configuration instead
    - lll
    
    # Maintidx: Measures maintainability index of functions
    # Disabled: Not useful for this project's coding style
    - maintidx
    
    # Mnd: Detects magic numbers
    # Disabled: Not all numbers need to be named constants
    - mnd
    
    # Musttag: Enforces field tags in structs
    # Disabled: Not all structs require tags
    - musttag
    
    # Perfsprint: Checks for performance issues with fmt.Sprint
    # Disabled: Performance impact is negligible in most cases
    - perfsprint
    
    # Recvcheck: Checks receiver naming conventions
    # Disabled: Receiver naming is handled by other linters
    - recvcheck
    
    # Varnamelen: Checks variable name length
    # Disabled: Short variable names are acceptable in limited scopes
    - varnamelen
    
    # Wrapcheck: Checks that errors from external packages are wrapped
    # Disabled: Too strict for this project's error handling
    - wrapcheck
    
    # Wsl: Enforces whitespace rules
    # Disabled: Too opinionated about spacing
    - wsl
    
    # Noinlineerr: Checks that errors are not inlined
    # Disabled: Inlined errors are acceptable in certain contexts
    - noinlineerr
  
  # Linter-specific settings
  # Configures behavior of individual linters
  settings:
    # Goheader: Checks file headers match a template
    goheader:
      # Dynamic values for the header template
      values:
        regexp:
          # Matches copyright year patterns: "2023", "2023 - 2024", "2023, 2024"
          YEARS: (20\d\d - 20\d\d|20\d\d, 20\d\d|20\d\d)
      # Required header template for all Go files
      template: |-
        Copyright Â© {{ YEARS }} Attestant Limited.
        Licensed under the Apache License, Version 2.0 (the "License");
        you may not use this file except in compliance with the License.
        You may obtain a copy of the License at

            http://www.apache.org/licenses/LICENSE-2.0

        Unless required by applicable law or agreed to in writing, software
        distributed under the License is distributed on an "AS IS" BASIS,
        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        See the License for the specific language governing permissions and
        limitations under the License.
    
    # Gosec: Security-focused linter
    gosec:
      # Exclude specific security checks
      excludes:
        # G115: Integer overflow conversion check
        # Excluded: Can produce false positives in safe conversion scenarios
        - G115
    
    # Lll: Line length checker (disabled above but kept for reference)
    lll:
      # Maximum line length before reporting
      line-length: 132
    
    # Revive: Fast, configurable, extensible, flexible linter
    revive:
      # Minimum confidence level for issues (0.0 to 1.0)
      # Higher values mean fewer, more confident reports
      confidence: 0.8
      
      # Severity level for all issues
      # Options: error, warning
      severity: error
      
      # Enable all revive rules by default
      enable-all-rules: true
      
      # Rule-specific configurations
      rules:
        # Add-constant: Suggests adding constants for magic numbers
        # Disabled: Handled by mnd linter instead
        - name: add-constant
          disabled: true
        
        # Cyclomatic: Calculates cyclomatic complexity
        # Disabled: Already handled by cyclop linter
        - name: cyclomatic
          disabled: true
        
        # Cognitive-complexity: Measures cognitive complexity
        # Disabled: Too strict for practical use
        - name: cognitive-complexity
          disabled: true
        
        # Confusing-results: Checks for confusing result naming
        # Enabled with default settings
        - name: confusing-results
        
        # Function-length: Checks function length
        # Disabled: Function length is contextual
        - name: function-length
          disabled: true
        
        # Line-length-limit: Enforces maximum line length
        # Enabled with 132 character limit
        - name: line-length-limit
          arguments:
            - 132
        
        # Max-public-structs: Limits number of public structs in a file
        # Disabled: No arbitrary limit needed
        - name: max-public-structs
          disabled: true
        
        # Package-comments: Requires package-level comments
        # Disabled: Not all packages need comments
        - name: package-comments
          disabled: true
        
        # Struct-tag: Validates struct tag format
        # Configured to allow "allowempty" option for json tags
        - name: struct-tag
          arguments:
            - json,allowempty
        
        # Unhandled-error: Checks for unhandled errors
        # Configured to ignore specific print functions that rarely need error checking
        - name: unhandled-error
          arguments:
            - fmt.Fprint
            - fmt.Fprintf
    
    # Staticcheck: Advanced static analysis linter
    staticcheck:
      # List of checks to enable/disable
      checks:
        # Enable all staticcheck rules
        - all
        # Disable ST1000: Package comment requirements
        # Disabled: Handled by revive's package-comments rule
        - -ST1000
    
    # Tagliatelle: Checks struct tag naming conventions
    tagliatelle:
      # Case conventions for different tag types
      case:
        rules:
          # JSON tags should use camelCase
          json: camel
          # YAML tags should use snake_case
          yaml: snake
  
  # Exclusions configuration
  # Defines what files/issues to exclude from linting
  exclusions:
    # How to handle generated files
    # Options: strict (lint everything), lax (skip generated files)
    generated: lax
    
    # Preset exclusion patterns for common false positives
    presets:
      # Comment-related exclusions (e.g., TODO comments)
      - comments
      # Common false positive patterns
      - common-false-positives
      # Legacy code patterns that may not meet current standards
      - legacy
      # Standard error handling patterns that may trigger false positives
      - std-error-handling
    
    # Path-based exclusions
    # Files matching these patterns are excluded from linting
    paths:
      # SSZ (Simple Serialize) generated files
      - .*_ssz\.go$
      # Third-party code
      - third_party$
      # Built-in packages
      - builtin$
      # Example code
      - examples$

    rules:
      # Suppress revive var-naming warning for generic package name in the types and util packages
      - path: types/.*.go
        text: "var-naming: avoid meaningless package names.*"
      - path: util/.*.go
        text: "var-naming: avoid meaningless package names.*"
      # Suppress revive package-directory-mismatch warning for client package
      # The package name "client" is intentionally shorter than the directory name for API clarity
      - path: service\.go
        text: "package-directory-mismatch: package name \"client\" does not match directory name \"go-execution-client\".*"

# Formatters configuration
# Controls automatic code formatting
formatters:
  # Enabled formatters
  enable:
    # Gofmt: Standard Go formatter
    - gofmt
    # Gofumpt: Stricter version of gofmt
    - gofumpt
    # Goimports: Manages import statements and runs gofmt
    - goimports
  
  # Formatter exclusions
  # Files matching these patterns are excluded from formatting
  exclusions:
    # How to handle generated files
    # Options: strict (format everything), lax (skip generated files)
    generated: lax
    
    # Path-based exclusions for formatting
    paths:
      # SSZ (Simple Serialize) generated files
      - .*_ssz\.go$
      # Third-party code
      - third_party$
      # Built-in packages
      - builtin$
      # Example code
      - examples$
